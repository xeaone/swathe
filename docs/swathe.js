/*
	@preserve
	title: swathe
	version: 2.0.0
	license: mpl-2.0
	author: alexander elias
*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('Swathe',b):a.Swathe=b()})(this,function(){'use strict';function a(j,m){this.isChangeEventAdded=!1,this.controller=m,this.isChanging=!1,this.element=j,this.listeners={},this.clone}function b(){}function d(j,m){if(this.callback=m,this.doc=j.doc,this.name=j.name,this.view=j.view||{},this.model=j.model||{},this.modifiers=j.modifiers||{},this.sPrefix=j.prefix+'-',this.sValue=j.prefix+'-value',this.sFor=j.prefix+'-for-(.*?)="',this.sAccepts=j.prefix+'-(.*?)="',this.sRejects=j.prefix+'-controller=|'+j.rejects,this.query='['+j.prefix+'-controller='+j.name+']',this.rPath=/(\s)?\|(.*?)$/,this.rModifier=/^(.*?)\|(\s)?/,this.rFor=new RegExp(this.sFor),this.rPrefix=new RegExp(this.sPrefix),this.rAccepts=new RegExp(this.sAccepts),this.rRejects=new RegExp(this.sRejects),this.scope=j.doc.querySelector(this.query),!this.scope)throw new Error('missing attribute s-controller '+j.name)}var f={GET:2,SET:3,toCamelCase:function(j){return'Array'===j.constructor.name&&(j=j.join('-')),j.replace(/-[a-z]/g,function(m){return m[1].toUpperCase()})},toDashCase:function(j){return'Array'===j.constructor.name&&(j=j.join('')),j.replace(/[A-Z]/g,function(m){return'-'+m.toLowerCase()})},interact:function(j,m,n,o){for(var t,p=n.split('.'),q=p.length-1,r=m,s=0;s<q;s++){if(t=p[s],null===r[t]||void 0===r[t]){if(j===this.GET)return;j===this.SET&&(r[t]={})}r=r[t]}if(j===this.GET)return r[p[q]];return j===this.SET?(r[p[q]]=o,m):void 0},getByPath:function(j,m){return this.interact(this.GET,j,m)},setByPath:function(j,m,n){return this.interact(this.SET,j,m,n)},glance:function(j){for(var m,n=j.nodeName.toLowerCase(),o=0,p=j.attributes.length;o<p;o++)m=j.attributes[o],n=n+' '+m.name+'="'+m.value+'"';return n},eachElement:function(j,m,n,o,p){for(var r,s,q=0;q<j.length;q++)if(r=j[q],s=this.glance(r),m&&m.test(s))q+=r.children.length;else if(n&&n.test(s))continue;else o&&o.test(s)&&p(r,q)}};a.prototype.on=function(j){if('function'==typeof j.value){var m=this,n=j.cmds[1],o=j.opts[j.opts.length-1];m.element.removeEventListener(n,m.listeners[o],!1),m.listeners[o]=function(p){p.preventDefault(),j.value.call(m.controller.model,p)},m.element.addEventListener(n,m.listeners[o],!1)}},a.prototype.each=function(j){var m=this;m.clone||(m.clone=m.element.children[0]);var n=j.cmds.slice(1),o=m.clone.cloneNode(!0),p='';o=o.outerHTML,n=f.toCamelCase(n),n=new RegExp('="'+n+'"','g');for(var q=0,r=j.value.length;q<r;q++)p+=o.replace(n,'="'+j.attribute.value+'.'+q.toString()+'"');m.element.innerHTML=p,m.controller.insert(m.element.getElementsByTagName('*'))},a.prototype.value=function(j){var m=this;if(('checkbox'===m.element.type||'radio'===m.element.type)&&(j.value=m.modifiers(j.attribute.value,j.value),m.element.value=j.value,m.element.checked=j.value),!m.isChangeEventAdded){m.isChangeEventAdded=!0;var n=function(o){if(!m.isChanging){m.isChanging=!0;var p=o.target,q='checkbox'===p.type||'radio'===p.type?p.checked:p.value,r=p.getAttribute(m.controller.sValue);q=m.modifiers(r,q),r=r.replace(m.controller.rPath,''),f.setByPath(m.controller.model,r,q),m.isChanging=!1}};m.element.addEventListener('change',n),m.element.addEventListener('keyup',n)}},a.prototype.html=function(j){this.element.innerHTML=j.value,this.controller.insert(this.element.getElementsByTagName('*'))},a.prototype.css=function(j){1<j.cmds.length&&(j.value=j.cmds.slice(1).join('-')+': '+j.value+';'),this.element.style.cssText+=j.value},a.prototype.class=function(j){var m=j.cmds.slice(1).join('-');this.element.classList.toggle(m,j.value)},a.prototype.enable=function(j){this.element.disabled=!j.value},a.prototype.disable=function(j){this.element.disabled=j.value},a.prototype.show=function(j){this.element.hidden=!j.value},a.prototype.hide=function(j){this.element.hidden=j.value},a.prototype.write=function(j){this.element.readOnly=!j.value},a.prototype.read=function(j){this.element.readOnly=j.value},a.prototype.selected=function(j){this.element.selectedIndex=j.value},a.prototype.text=function(j){this.element.innerText=j.value},a.prototype.default=function(j){var m=f.toCamelCase(j.cmds);f.setByPath(this.element,m,j.value)},a.prototype.modifiers=function(j,m){if(-1===j.indexOf('|'))return m;for(var n=this,o=j.replace(n.controller.rModifier,'').split(' '),p=0,q=o.length;p<q;p++)o[p]in n.controller.modifiers&&(m=n.controller.modifiers[o[p]].call(m));return m},a.prototype.render=function(j){var m=this,n={attribute:j};n.attribute.value=n.attribute.value.trim(),n.path=n.attribute.value.replace(m.controller.rPath,''),n.command=n.attribute.name.replace(m.controller.rPrefix,''),n.opts=n.path.split('.'),n.cmds=n.command.split('-'),n.value=f.getByPath(m.controller.model,n.path),n.value=m.modifiers(n.attribute.value,n.value);null===n.value||void 0===n.value||(n.cmds[0]in m?m[n.cmds[0]](n):m.default(n))},a.prototype.eachAttribute=function(j,m){var n=this.element.attributes,o=0,p=n.length,q;for('string'==typeof j&&(j=new RegExp(j)),o;o<p;o++)q={name:n[o].name,value:n[o].value,full:n[o].name+'="'+n[o].value+'"'},j&&j.test(q.full)&&m(q,o)},b.prototype.descriptor=function(j,m,n){return{configurable:!0,enumerable:!0,get:function(){return m},set:function(o){m=o,n(j,m)}}},b.prototype.ins=function(j,m,n,o,p){('Object'===p.constructor.name||'Array'===p.constructor.name)&&(p=this.create(p,m,n+o,!0)),'Array'===j.constructor.name&&-1==o&&(o=0,j.splice(o,0,p),j=Object.defineProperty(j,o,this.descriptor(n+o,p,m)),o=j.length-1,p=j[o]),j=Object.defineProperty(j,o,this.descriptor(n+o,p,m)),m&&m(n+o,p)},b.prototype.del=function(j,m,n,o){if('Object'===j.constructor.name)delete j[o];else if('Array'===j.constructor.name){var p=j.length-1;j.splice(o,1),o=p}m&&m(n+o,void 0)},b.prototype.create=function(j,m,n,o){var p,q,r,s;for(q in n?n+='.':n='',s=j.constructor.name,p='Object'===s?{}:[],p=Object.defineProperty(p,'ins',{value:this.ins.bind(this,p,m,n)}),p=Object.defineProperty(p,'del',{value:this.del.bind(this,p,m,n)}),j)r=j[q],s=r.constructor.name,('Object'===s||'Array'===s)&&(r=this.create(r,m,n+q)),p=Object.defineProperty(p,q,this.descriptor(n+q,r,m)),o&&m&&m(n+q,r);return p};var g=function(j,m){return new b().create(j,m)};d.prototype.insert=function(j){var m=this;f.eachElement(j,m.rRejects,null,m.rAccepts,function(n,o){var p=new a(n,m);p.eachAttribute(m.rAccepts,function(q){m.rFor.test(q.name)&&++o,m.view[q.value]?m.view[q.value].push(p):m.view[q.value]=[p],p.render(q)})})},d.prototype.setup=function(){var j=this;j.model=g(j.model,function(m){var n=m.split('.');1<n.length&&!isNaN(n.slice(-1))&&(m=n.slice(0,-1).join('.'));var o=j.view[m];if(o)for(var r,p=0,q=o.length;p<q;p++)r=o[p],r.eachAttribute(j.sAccepts+m,function(s){r.render(s)})}),j.insert(j.scope.getElementsByTagName('*')),j.callback&&j.callback.call(this)};var h={prefix:'s',doc:document,controllers:{},rejects:'iframe|object|script',controller:function(j,m){if(!j.name)throw new Error('Controller - name parameter required');if(j.name in this.controllers)throw new Error('Controller - name '+j.name+' exists');j.doc=j.doc||this.doc,j.prefix=j.prefix||this.prefix,j.rejects=j.rejects||this.rejects;var n=new d(j,m);return n.setup(),this.controllers[j.name]=n,n}};return h});